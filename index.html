<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Gas Monitor</title>
    
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #0f172a; color: white; text-align: center; margin: 0; padding: 20px; overflow-x: hidden; }
        .container { max-width: 400px; margin: 20px auto; background: #1e293b; padding: 25px; border-radius: 20px; border: 1px solid #334155; }
        
        /* Fixed Gauge logic - avoids "trimming" errors */
        .gauge-area { position: relative; width: 220px; height: 110px; margin: 20px auto; overflow: hidden; }
        .gauge-bg { width: 220px; height: 220px; border-radius: 50%; border: 20px solid #334155; position: absolute; top: 0; left: 0; }
        .gauge-fill { 
            width: 220px; height: 220px; border-radius: 50%; border: 20px solid transparent; 
            position: absolute; top: 0; left: 0; transform: rotate(-45deg); 
            transition: transform 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), border-color 0.8s; 
            z-index: 10;
        }

        .weight-num { font-size: 48px; font-weight: 800; margin-top: 10px; color: #f8fafc; line-height: 1; }
        .unit-label { font-size: 18px; color: #94a3b8; font-weight: normal; }

        /* Mobile-Friendly Status Cards */
        #status-card { 
            padding: 18px; border-radius: 12px; margin-top: 25px; font-weight: bold; font-size: 1.1rem;
            transition: all 0.4s ease; background: #334155; border: 2px solid transparent;
        }
        .safe { background-color: #064e3b !important; color: #10b981; border-color: #10b981 !important; }
        .danger { background-color: #450a0a !important; color: #ef4444; border-color: #ef4444 !important; }
        
        /* Dim UI if data is stale */
        .stale { opacity: 0.5; filter: grayscale(80%); }
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

    <div class="container" id="main-container">
        <h2 style="color: #38bdf8; margin: 0 0 5px 0;">Gas Monitor</h2>
        <p id="time-stamp" style="font-size: 11px; color: #64748b; margin-bottom: 20px;">LAST UPDATE: WAITING...</p>

        <div class="gauge-area">
            <div class="gauge-bg"></div>
            <div class="gauge-fill" id="gauge-fill"></div>
        </div>

        <div class="weight-num"><span id="weight-val">0.0</span> <span class="unit-label">KG</span></div>
        <p id="weight-status" style="font-weight: bold; margin-top: 5px; color: #94a3b8;">DISCONNECTED</p>

        <div id="status-card">
            <span id="leak-text">CHECKING SENSORS...</span>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBerTPAkCYx2tj5A9fMhlcZnlLguMbimRg",
            authDomain: "gasmonitor-6e61b.firebaseapp.com",
            databaseURL: "https://gasmonitor-6e61b-default-rtdb.firebaseio.com",
            projectId: "gasmonitor-6e61b",
            storageBucket: "gasmonitor-6e61b.firebasestorage.app",
            messagingSenderId: "591726728932",
            appId: "1:591726728932:web:76fb463130844fc69e3ef1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('cylinder').on('value', (snapshot) => {
            const data = snapshot.val();
            const fill = document.getElementById('gauge-fill');
            const card = document.getElementById('status-card');
            
            if (data) {
                // Clear the "stale" look
                document.getElementById('main-container').classList.remove('stale');
                document.getElementById('time-stamp').innerText = "LAST UPDATE: " + new Date().toLocaleTimeString();

                const weight = parseFloat(data.weight);
                document.getElementById('weight-val').innerText = weight.toFixed(1);

                // GAUGE MAPPING: 0kg = -45deg, 15kg = 135deg
                let rotation = (weight / 15) * 180 - 45;
                if (rotation > 135) rotation = 135;
                if (rotation < -45) rotation = -45;
                fill.style.transform = `rotate(${rotation}deg)`;

                // Weight Color Logic
                let color = "#10b981"; // Green
                let msg = "FULL";
                if (weight <= 5) { color = "#ef4444"; msg = "CRITICAL"; }
                else if (weight <= 10) { color = "#f59e0b"; msg = "LOW"; }

                fill.style.borderTopColor = color;
                fill.style.borderRightColor = color;
                document.getElementById('weight-status').innerText = "STATUS: " + msg;
                document.getElementById('weight-status').style.color = color;

                // Leakage Logic
                if (data.leakage === true) {
                    document.getElementById('leak-text').innerText = "⚠️ DANGER: LEAK DETECTED";
                    card.className = "danger";
                } else {
                    document.getElementById('leak-text').innerText = "✅ NO LEAKAGE DETECTED";
                    card.className = "safe";
                }
            }
        });
    </script>
</body>
</html>
