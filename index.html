<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cylinder Smart Monitor</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0f172a; color: white; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: #1e293b; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        
        /* Fixed Semi-Circle Gauge */
        .gauge-container {
            position: relative;
            width: 200px;
            height: 100px; /* Half height for semi-circle */
            margin: 20px auto;
            overflow: hidden; /* This creates the semi-circle clip */
        }
        .gauge-outline {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 15px solid #334155;
            box-sizing: border-box;
        }
        .gauge-fill {
            position: absolute;
            top: 0; left: 0;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 15px solid transparent;
            /* The actual "needle" color is handled by JS */
            border-bottom-color: #10b981; 
            border-right-color: #10b981;
            transform: rotate(-45deg); /* Start point */
            transition: transform 1s ease-out, border-color 0.5s;
            box-sizing: border-box;
        }

        .weight-text { font-size: 38px; font-weight: bold; margin-top: 10px; color: #38bdf8; }
        .label { font-size: 12px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        
        /* Status Box */
        #status-box { 
            padding: 15px; border-radius: 12px; margin-top: 20px; font-weight: bold;
            border: 2px solid #334155; transition: 0.3s;
        }
        .leak-danger { background: #450a0a; color: #ef4444; border-color: #ef4444 !important; animation: pulse 1s infinite; }
        .leak-safe { background: #064e3b; color: #10b981; border-color: #10b981 !important; }

        @keyframes pulse { 50% { opacity: 0.7; transform: scale(0.98); } }
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

    <div class="container">
        <h2 style="color: #38bdf8; margin-bottom: 5px;">Gas Monitor</h2>
        <p style="color: #94a3b8; font-size: 14px; margin-top: 0;">Live IoT Dashboard</p>

        <div class="gauge-container">
            <div class="gauge-outline"></div>
            <div class="gauge-fill" id="gauge-fill"></div>
        </div>
        
        <div class="weight-text"><span id="weight-val">0.0</span> <small style="font-size: 16px;">KG</small></div>
        <p id="fuel-status" style="font-size: 14px; font-weight: bold; margin-top: 5px;">WAITING FOR DATA...</p>

        <hr style="border: 0; border-top: 1px solid #334155; margin: 20px 0;">

        <p class="label">Gas Leakage Status</p>
        <div id="status-box" class="leak-safe">
            <span id="leak-text">CONNECTING...</span>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBerTPAkCYx2tj5A9fMhlcZnlLguMbimRg",
            authDomain: "gasmonitor-6e61b.firebaseapp.com",
            databaseURL: "https://gasmonitor-6e61b-default-rtdb.firebaseio.com",
            projectId: "gasmonitor-6e61b",
            storageBucket: "gasmonitor-6e61b.firebasestorage.app",
            messagingSenderId: "591726728932",
            appId: "1:591726728932:web:76fb463130844fc69e3ef1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('cylinder').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                const weight = parseFloat(data.weight);
                const fill = document.getElementById('gauge-fill');
                const fuelStatus = document.getElementById('fuel-status');
                
                document.getElementById('weight-val').innerText = weight.toFixed(1);
                
                // GAUGE LOGIC
                // We map weight (0 to 15) to rotation (-45deg to 135deg)
                let rotation = (weight / 15) * 180 - 45;
                if (rotation > 135) rotation = 135;
                if (rotation < -45) rotation = -45;
                fill.style.transform = `rotate(${rotation}deg)`;

                // COLOR LOGIC
                if (weight > 10) {
                    fill.style.borderBottomColor = "#10b981"; // Green
                    fill.style.borderRightColor = "#10b981";
                    fuelStatus.innerText = "CYLINDER FULL";
                    fuelStatus.style.color = "#10b981";
                } else if (weight > 5) {
                    fill.style.borderBottomColor = "#f59e0b"; // Orange
                    fill.style.borderRightColor = "#f59e0b";
                    fuelStatus.innerText = "GAS RUNNING LOW";
                    fuelStatus.style.color = "#f59e0b";
                } else {
                    fill.style.borderBottomColor = "#ef4444"; // Red
                    fill.style.borderRightColor = "#ef4444";
                    fuelStatus.innerText = "CRITICAL: REFILL SOON";
                    fuelStatus.style.color = "#ef4444";
                }

                // LEAKAGE LOGIC
                const box = document.getElementById('status-box');
                const text = document.getElementById('leak-text');
                if (data.leakage === true) {
                    text.innerText = "⚠️ DANGER: LEAK DETECTED";
                    box.className = "leak-danger";
                } else {
                    text.innerText = "✅ NO LEAKAGE DETECTED";
                    box.className = "leak-safe";
                }
            }
        });
    </script>
</body>
</html>
