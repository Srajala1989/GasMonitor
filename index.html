<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Gas Monitor</title>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; background-color: #0f172a; color: white; display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 380px; background: #1e293b; padding: 25px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #334155; }
        
        /* GAUGE AREA */
        .gauge-wrapper {
            position: relative;
            width: 220px;
            height: 110px;
            margin: 0 auto 15px auto;
            overflow: hidden;
        }

        .gauge-bg {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            border: 18px solid #334155;
            position: absolute;
            top: 0; left: 0;
            box-sizing: border-box;
        }

        .gauge-fill {
            position: absolute;
            top: 0; left: 0;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            border: 18px solid transparent;
            /* This rotation logic keeps the colored part within the top-half visible area */
            transform: rotate(-45deg); 
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.5s;
            z-index: 2;
            box-sizing: border-box;
        }

        .weight-display { margin-top: 5px; }
        .weight-num { font-size: 56px; font-weight: 800; color: #f8fafc; line-height: 1; }
        .unit { font-size: 20px; color: #94a3b8; margin-left: 4px; }
        
        #status-box { 
            padding: 18px; border-radius: 15px; margin-top: 20px; font-weight: bold;
            border: 2px solid #334155; transition: 0.4s; background: #111827;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .safe { color: #10b981; border-color: #10b981 !important; }
        .danger { color: #ef4444; border-color: #ef4444 !important; animation: blink 1.2s infinite; }

        @keyframes blink { 50% { opacity: 0.5; } }
        #time-stamp { font-size: 11px; color: #64748b; margin-top: 20px; text-transform: uppercase; letter-spacing: 1px; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

    <div class="container">
        <h3 style="color: #38bdf8; margin-bottom: 25px; font-size: 14px; letter-spacing: 2px; text-align: left;">LIVE GAS MONITOR</h3>

        <div class="gauge-wrapper">
            <div class="gauge-bg"></div>
            <div class="gauge-fill" id="gauge-fill"></div>
        </div>

        <div class="weight-display">
            <div class="weight-num"><span id="weight-val">0.0</span><span class="unit">kg</span></div>
            <p id="fuel-status" style="font-weight: bold; margin-top: 10px; font-size: 14px; letter-spacing: 1px;">SYNCING...</p>
        </div>

        <div id="status-box" class="safe">
            <span id="leak-icon">✅</span>
            <span id="leak-text">NO LEAKAGE DETECTED</span>
        </div>

        <p id="time-stamp">LAST UPDATE: --:--:--</p>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBerTPAkCYx2tj5A9fMhlcZnlLguMbimRg",
            authDomain: "gasmonitor-6e61b.firebaseapp.com",
            databaseURL: "https://gasmonitor-6e61b-default-rtdb.firebaseio.com",
            projectId: "gasmonitor-6e61b",
            storageBucket: "gasmonitor-6e61b.firebasestorage.app",
            messagingSenderId: "591726728932",
            appId: "1:591726728932:web:76fb463130844fc69e3ef1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('cylinder').on('value', (snapshot) => {
            const data = snapshot.val();
            const fill = document.getElementById('gauge-fill');
            const statusText = document.getElementById('fuel-status');
            const timeText = document.getElementById('time-stamp');
            
            if (data) {
                const weight = parseFloat(data.weight);
                document.getElementById('weight-val').innerText = weight.toFixed(1);
                timeText.innerText = "LAST UPDATE: " + new Date().toLocaleTimeString();

                // CORRECTED GAUGE CALCULATION:
                // We want the gauge to fill from LEFT to RIGHT.
                // Weight 0 = -45 degrees (Left start)
                // Weight 15 = 135 degrees (Right end)
                let rotation = (weight / 15) * 180 - 45;
                
                if (rotation > 135) rotation = 135;
                if (rotation < -45) rotation = -45;
                
                fill.style.transform = `rotate(${rotation}deg)`;

                // Dynamic Colors
                let color = "#10b981"; // Green
                let msg = "CYLINDER FULL";

                if (weight <= 4) {
                    color = "#ef4444"; 
                    msg = "REFILL IMMEDIATELY";
                } else if (weight <= 10) {
                    color = "#f59e0b"; 
                    msg = "GAS LEVEL LOW";
                }

                // Apply color to the active borders
                fill.style.borderLeftColor = color;
                fill.style.borderTopColor = color;
                statusText.innerText = msg;
                statusText.style.color = color;

                // Leakage UI
                const box = document.getElementById('status-box');
                const leakLabel = document.getElementById('leak-text');
                const leakIcon = document.getElementById('leak-icon');
                if (data.leakage === true) {
                    leakLabel.innerText = "GAS LEAKAGE DETECTED";
                    leakIcon.innerText = "⚠️";
                    box.className = "danger";
                } else {
                    leakLabel.innerText = "NO LEAKAGE DETECTED";
                    leakIcon.innerText = "✅";
                    box.className = "safe";
                }
            }
        });
    </script>
</body>
</html>
